<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Drag and Drop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/dropDown.css}">
</head>
<body>
<!-- Navbar -->
<nav class="navbar bg-light p-3">
    <div class="d-flex">
        <button class="btn btn-primary me-2 rounded" data-bs-toggle="modal" data-bs-target="#createFolderModal">New
            folder
        </button>
        <button class="btn btn-primary me-2 rounded" data-bs-toggle="modal" data-bs-target="#uploadFileModal">Upload
            file
        </button>
        <button class="btn btn-primary me-2 rounded" data-bs-toggle="modal" data-bs-target="#uploadFolderModal">Upload
            folder
        </button>

    </div>
    <div>
        <button class="btn btn-primary rounded" onclick="logout()">Log Out</button>
    </div>
</nav>

<!-- Breadcrumbs -->
<div class="p-3">
    <p>
            <span th:each="entry : ${breadcrumbs}">
                <a th:if="${entry.value == 'Home'}" th:href="@{/}" th:text="${entry.value}"></a>
                <a th:unless="${entry.value == 'Home'}" th:href="@{/(path=${entry.key})}" th:text="${entry.value}"></a>
                <span>/</span>
            </span>
    </p>
</div>

<!-- File and Folder List -->
<div th:each="item : ${itemDto}" class="d-flex align-items-center justify-content-between p-3">
    <div class="d-flex align-items-center">
        <i class="bi bi-folder me-2" th:if="${item.isDir()}" style="font-size: 24px;"></i>
        <i class="bi bi-file-earmark me-2" th:unless="${item.isDir()}" style="font-size: 24px;"></i>
        <a th:if="${item.isDir()}" th:href="@{/(path=${item.path})}" th:text="${item.name}"></a>
        <p th:unless="${item.isDir()}" th:text="${item.name}" class="mb-0"></p>
    </div>

    <!-- Dropdown Menu Button -->
    <div class="dropdown">
        <button class="btn btn-secondary" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
            <i class="bi bi-three-dots-vertical"></i>
        </button>

        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">


            <!-- Rename folder -->
            <a class="dropdown-item" th:if="${item.isDir()}" href="#" data-bs-toggle="modal"
               th:data-bs-target="'#renameFileModal'">
                <button>
                    <i class="bi bi-pencil"></i>
                </button>
            </a>

            <!-- Delete folder -->
            <a class="dropdown-item" th:if="${item.isDir()}" href="#">
                <form th:method="DELETE" th:action="@{/folder/delete}">
                    <input type="hidden" th:name="fullPath" th:value="${item.fullPath}">
                    <button type="submit">
                        <i class="bi bi-trash"></i>
                    </button>
                </form>
            </a>


            <!-- Rename file -->
            <a class="dropdown-item" th:unless="${item.isDir()}" href="#" data-bs-toggle="modal"
               th:data-bs-target="'#renameFileModal'">
                <button>
                    <i class="bi bi-pencil"></i>
                </button>
            </a>

            <!-- Delete file -->
            <a class="dropdown-item" th:unless="${item.isDir()}" href="#">
                <form th:method="DELETE" th:action="@{/file/delete}">
                    <input type="hidden" th:name="fullPath" th:value="${item.fullPath}">
                    <button type="submit">
                        <i class="bi bi-trash"></i>
                    </button>
                </form>
            </a>

            <!-- Download file -->
            <a class="dropdown-item" th:unless="${item.isDir()}" href="#">
                <form th:method="GET" th:action="@{/file/download}">
                    <input type="hidden" th:name="name" th:value="${item.name}">
                    <input type="hidden" th:name="path" th:value="${item.fullPath}">
                    <button type="submit">
                        <i class="bi bi-download"></i>
                    </button>
                </form>
            </a>
        </div>
    </div>

    <!-- File rename modal-->
    <div class="modal fade" id="renameFileModal" tabindex="-1" aria-labelledby="renameFileModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="renameFileModalLabel">Rename File</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/folder/rename}" th:method="PATCH">
                        <div class="mb-3">
                            <label for="newFileName" class="form-label">New Name</label>
                            <input type="text" class="form-control" id="newFileName" th:name="newName">
                        </div>
                        <input type="hidden" th:name="oldPath" th:value="${item.fullPath}">
                        <button type="submit" class="btn btn-primary">Rename</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal for Creating Folder -->
<div class="modal fade" id="createFolderModal" tabindex="-1" aria-labelledby="createFolderModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createFolderModalLabel">Create New Folder</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form th:method="POST" th:action="@{/folder/add}">
                    <div class="mb-3">
                        <label for="folderName" class="form-label">Folder Name</label>
                        <input type="text" id="folderName" th:name="name" class="form-control">
                        <input type="hidden" th:name="folderLocation" th:value="${url}"/>
                        <input type="hidden" th:name="ownerId" th:value="${owner.id}"/>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Folder</button>
                </form>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="uploadFileModal" tabindex="-1" aria-labelledby="uploadFileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadFileModalLabel">Upload File</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form th:method="POST" th:action="@{/file/upload}" enctype="multipart/form-data">
                    <div class="drop-zone" id="dropFileZone">
                        <span class="drop-zone__prompt">Drop file here or click to upload</span>
                        <input type="file" name="file" id="fileUpload" class="drop-zone__input">
                    </div>
                    <input type="hidden" th:value="${url}" th:name="path"/>
                    <input type="hidden" th:value="${owner.id}" th:name="ownerId"/>
                    <button type="submit" class="btn btn-primary mt-2 w-100">Upload file</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="uploadFolderModal" tabindex="-1" aria-labelledby="uploadFolderModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadFolderModalLabel">Upload folder</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form th:method="POST" th:action="@{/folder/upload}" enctype="multipart/form-data">
                    <div class="drop-zone" id="dropFolderZone">
                        <span class="drop-zone__prompt">Drop file here or click to upload</span>
                        <input type="file" name="files" id="filesUpload" class="drop-zone__input" multiple
                               webkitdirectory>
                    </div>
                    <input type="hidden" th:value="${url}" th:name="path"/>
                    <input type="hidden" th:value="${owner.id}" th:name="ownerId"/>
                    <button type="submit" class="btn btn-primary mt-2 w-100">Upload folder</button>
                </form>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/main.js}"></script>
</body>
</html>
